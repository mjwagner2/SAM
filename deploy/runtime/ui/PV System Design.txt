PV System Design
843
984
89
GroupBox

1
7
Name
5
9
GroupBox1
X
3
9
Y
3
6
Width
3
824
Height
3
125
Caption
5
13
System Sizing
Bold
2
1
GroupBox

1
7
Name
5
9
GroupBox2
X
3
9
Y
3
390
Width
3
824
Height
3
479
Caption
5
12
DC Subarrays
Bold
2
1
GroupBox

1
7
Name
5
9
GroupBox4
X
3
9
Y
3
135
Width
3
824
Height
3
253
Caption
5
37
Configuration at Reference Conditions
Bold
2
1
GroupBox

1
7
Name
5
9
GroupBox7
X
3
9
Y
3
873
Width
3
825
Height
3
89
Caption
5
30
Estimate of Overall Land Usage
Bold
2
1
Divider

1
9
Name
5
6
HLine1
X
3
18
Y
3
474
Width
3
802
Height
3
18
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
20
String Configuration
Bold
2
1
Divider

1
9
Name
5
7
HLine12
X
3
18
Y
3
543
Width
3
802
Height
3
24
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
22
Tracking & Orientation
Bold
2
1
Label

1
12
Name
5
6
Label1
X
3
561
Y
3
162
Width
3
260
Height
3
21
Caption
5
39
Sizing messages (see Help for details):
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
7
Label11
X
3
72
Y
3
519
Width
3
218
Height
3
21
Caption
5
29
Strings allocated to subarray
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
12
Name
5
8
Label122
X
3
66
Y
3
801
Width
3
218
Height
3
21
Caption
5
12
Backtracking
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
12
Name
5
10
Label12283
X
3
66
Y
3
777
Width
3
218
Height
3
21
Caption
5
28
Tracker rotation limit (deg)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
12
Name
5
10
Label12284
X
3
66
Y
3
729
Width
3
218
Height
3
21
Caption
5
13
Azimuth (deg)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
12
Name
5
7
Label13
X
3
66
Y
3
705
Width
3
218
Height
3
21
Caption
5
10
Tilt (deg)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
12
Name
5
6
Label2
X
3
561
Y
3
291
Width
3
260
Height
3
66
Caption
5
89
Voltage and capacity ratings are at module reference conditions shown on the Module page.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
4294967295
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
12
Name
5
8
Label213
X
3
18
Y
3
411
Width
3
800
Height
3
60
Caption
5
285
To model a system with one array, specify properties for Subarray 1 and disable Subarrays 2, 3, and 4.  To model a sytem with up to four subarrays connected in parallel to a single bank of inverters, for each subarray, check Enable and specify a number of strings and other properties.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
4294967295
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
12
Name
5
8
Label214
X
3
297
Y
3
894
Width
3
533
Height
3
66
Caption
5
169
SAM uses the total land area only when you specify a $/acre cost on the System Costs page: Total land area = total module area ÷ GCR × 0.0002471 (1 m² = 0.0002471 acre).
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
4294967295
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
12
Name
5
6
Label3
X
3
366
Y
3
153
Width
3
110
Height
3
21
Caption
5
9
Inverters
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
7
Label31
X
3
129
Y
3
153
Width
3
110
Height
3
21
Caption
5
7
Modules
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
6
Label4
X
3
426
Y
3
459
Width
3
110
Height
3
21
Caption
5
10
Subarray 2
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
7
Label41
X
3
561
Y
3
459
Width
3
110
Height
3
21
Caption
5
10
Subarray 3
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
8
Label411
X
3
696
Y
3
459
Width
3
110
Height
3
21
Caption
5
10
Subarray 4
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
9
Label4111
X
3
294
Y
3
459
Width
3
110
Height
3
21
Caption
5
10
Subarray 1
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
12
Name
5
6
Label5
X
3
294
Y
3
495
Width
3
110
Height
3
21
Caption
5
16
(always enabled)
TextColour
4
128
128
128
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Image

1
7
Name
5
8
Picture1
X
3
30
Y
3
573
Width
3
190
Height
3
102
Image
7
PV System Design_Picture1.png
Centered
2
1
Numeric

1
16
Name
5
10
array_area
X
3
141
Y
3
897
Width
3
99
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
16
Name
5
14
batt_max_power
X
3
417
Y
3
321
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
14
Numeric

1
16
Name
5
10
dcac_ratio
X
3
165
Y
3
78
Width
3
100
Height
3
21
Value
1
1.100000
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
Numeric

1
16
Name
5
12
desired_size
X
3
165
Y
3
54
Width
3
100
Height
3
21
Value
1
10.000000
Mode
3
1
Format
3
1
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
2
Label

1
12
Name
5
8
gcr_info
X
3
18
Y
3
825
Width
3
795
Height
3
45
Caption
5
258
Ground coverage ratio is used (1) to determine when a one-axis tracking system will backtrack, (2) in self-shading calculations for fixed tilt or one-axis tracking systems on the Shading page, and (3) in the total land area calculation. See Help for details.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
4294967295
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
12
Name
5
9
gcr_label
X
3
84
Y
3
753
Width
3
200
Height
3
21
Caption
5
27
Ground coverage ratio (GCR)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Numeric

1
16
Name
5
14
inverter_count
X
3
417
Y
3
225
Width
3
82
Height
3
21
Value
1
1.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
MultilineText

1
10
Name
5
14
layout_warning
X
3
561
Y
3
186
Width
3
260
Height
3
99
Text
5
0
Editable
2
0
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
21
Numeric

1
16
Name
5
18
modules_per_string
X
3
150
Y
3
225
Width
3
82
Height
3
21
Value
1
10.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Numeric

1
16
Name
5
16
mppt_hi_inverter
X
3
417
Y
3
297
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
19
Numeric

1
16
Name
5
17
mppt_low_inverter
X
3
417
Y
3
273
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
18
Numeric

1
16
Name
5
17
num_strings_total
X
3
141
Y
3
495
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
22
Label

1
12
Name
5
34
pv_system_inverter_voltage_warning
X
3
273
Y
3
345
Width
3
270
Height
3
39
Caption
5
16
Inverter Warning
TextColour
4
255
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
RadioChoice

1
10
Name
5
19
size_auto_or_manual
X
3
30
Y
3
27
Width
3
794
Height
3
23
Selection
3
4294967295
Items
6
2
Specify desired array size
Specify modules and inverters
ShowCaptions
2
1
Horizontal
2
1
TabOrder
3
1
Numeric

1
16
Name
5
19
strings_in_parallel
X
3
150
Y
3
249
Width
3
82
Height
3
21
Value
1
4.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
Numeric

1
16
Name
5
17
subarray1_azimuth
X
3
288
Y
3
729
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
27
CheckBox

1
8
Name
5
19
subarray1_backtrack
X
3
288
Y
3
801
Width
3
101
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
25
Numeric

1
16
Name
5
13
subarray1_gcr
X
3
288
Y
3
753
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
27
MonthlyFactor

1
7
Name
5
22
subarray1_monthly_tilt
X
3
288
Y
3
702
Width
3
87
Height
3
24
Description
5
0
TabOrder
3
4294967295
Numeric

1
16
Name
5
18
subarray1_nstrings
X
3
294
Y
3
519
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
23
Numeric

1
16
Name
5
16
subarray1_rotlim
X
3
288
Y
3
777
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
27
Numeric

1
16
Name
5
14
subarray1_tilt
X
3
288
Y
3
705
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
26
CheckBox

1
8
Name
5
21
subarray1_tilt_eq_lat
X
3
288
Y
3
681
Width
3
119
Height
3
21
Caption
5
13
Tilt=latitude
State
2
0
TabOrder
3
25
RadioChoice

1
10
Name
5
20
subarray1_track_mode
X
3
288
Y
3
564
Width
3
113
Height
3
119
Selection
3
4294967295
Items
6
5
Fixed
1-Axis
2-Axis
Azimuth Axis
Seasonal Tilt
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
24
Numeric

1
16
Name
5
17
subarray2_azimuth
X
3
423
Y
3
729
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
34
CheckBox

1
8
Name
5
19
subarray2_backtrack
X
3
423
Y
3
801
Width
3
101
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
32
CheckBox

1
8
Name
5
16
subarray2_enable
X
3
426
Y
3
495
Width
3
101
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
29
Numeric

1
16
Name
5
13
subarray2_gcr
X
3
423
Y
3
753
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
34
MonthlyFactor

1
7
Name
5
22
subarray2_monthly_tilt
X
3
423
Y
3
702
Width
3
87
Height
3
24
Description
5
0
TabOrder
3
4294967295
Numeric

1
16
Name
5
18
subarray2_nstrings
X
3
426
Y
3
519
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
30
Numeric

1
16
Name
5
16
subarray2_rotlim
X
3
423
Y
3
777
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
34
Numeric

1
16
Name
5
14
subarray2_tilt
X
3
423
Y
3
705
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
33
CheckBox

1
8
Name
5
21
subarray2_tilt_eq_lat
X
3
423
Y
3
681
Width
3
113
Height
3
21
Caption
5
13
Tilt=latitude
State
2
0
TabOrder
3
32
RadioChoice

1
10
Name
5
20
subarray2_track_mode
X
3
423
Y
3
564
Width
3
113
Height
3
119
Selection
3
4294967295
Items
6
5
Fixed
1-Axis
2-Axis
Azimuth Axis
Seasonal tilt
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
31
Numeric

1
16
Name
5
17
subarray3_azimuth
X
3
558
Y
3
729
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
41
CheckBox

1
8
Name
5
19
subarray3_backtrack
X
3
558
Y
3
801
Width
3
98
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
39
CheckBox

1
8
Name
5
16
subarray3_enable
X
3
561
Y
3
495
Width
3
98
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
36
Numeric

1
16
Name
5
13
subarray3_gcr
X
3
558
Y
3
753
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
41
MonthlyFactor

1
7
Name
5
22
subarray3_monthly_tilt
X
3
558
Y
3
702
Width
3
87
Height
3
24
Description
5
0
TabOrder
3
4294967295
Numeric

1
16
Name
5
18
subarray3_nstrings
X
3
561
Y
3
519
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
37
Numeric

1
16
Name
5
16
subarray3_rotlim
X
3
558
Y
3
777
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
41
Numeric

1
16
Name
5
14
subarray3_tilt
X
3
558
Y
3
705
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
40
CheckBox

1
8
Name
5
21
subarray3_tilt_eq_lat
X
3
558
Y
3
681
Width
3
116
Height
3
21
Caption
5
13
Tilt=latitude
State
2
0
TabOrder
3
39
RadioChoice

1
10
Name
5
20
subarray3_track_mode
X
3
558
Y
3
564
Width
3
113
Height
3
119
Selection
3
4294967295
Items
6
5
Fixed
1-Axis
2-Axis
Azimuth Axis
Seasonal tilt
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
38
Numeric

1
16
Name
5
17
subarray4_azimuth
X
3
693
Y
3
729
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
48
CheckBox

1
8
Name
5
19
subarray4_backtrack
X
3
693
Y
3
801
Width
3
101
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
46
CheckBox

1
8
Name
5
16
subarray4_enable
X
3
696
Y
3
495
Width
3
98
Height
3
21
Caption
5
6
Enable
State
2
0
TabOrder
3
43
Numeric

1
16
Name
5
13
subarray4_gcr
X
3
693
Y
3
753
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
48
MonthlyFactor

1
7
Name
5
22
subarray4_monthly_tilt
X
3
693
Y
3
702
Width
3
87
Height
3
24
Description
5
0
TabOrder
3
4294967295
Numeric

1
16
Name
5
18
subarray4_nstrings
X
3
696
Y
3
519
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
44
Numeric

1
16
Name
5
16
subarray4_rotlim
X
3
693
Y
3
777
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
48
Numeric

1
16
Name
5
14
subarray4_tilt
X
3
693
Y
3
705
Width
3
100
Height
3
21
Value
1
0.000000
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
47
CheckBox

1
8
Name
5
21
subarray4_tilt_eq_lat
X
3
693
Y
3
681
Width
3
113
Height
3
21
Caption
5
13
Tilt=latitude
State
2
0
TabOrder
3
46
RadioChoice

1
10
Name
5
20
subarray4_track_mode
X
3
693
Y
3
564
Width
3
113
Height
3
119
Selection
3
4294967295
Items
6
5
Fixed
1-Axis
2-Axis
Azimuth Axis
Seasonal tilt
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
45
Numeric

1
16
Name
5
15
system_capacity
X
3
150
Y
3
177
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7
Numeric

1
16
Name
5
10
total_area
X
3
150
Y
3
273
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
Numeric

1
16
Name
5
26
total_dc_inverter_capacity
X
3
417
Y
3
201
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Numeric

1
16
Name
5
23
total_inverter_capacity
X
3
417
Y
3
177
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
14
Numeric

1
16
Name
5
15
total_land_area
X
3
141
Y
3
924
Width
3
100
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
52
Numeric

1
16
Name
5
13
total_modules
X
3
150
Y
3
201
Width
3
82
Height
3
21
Value
1
99999.000000
Mode
3
0
Format
3
0
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
8
Numeric

1
16
Name
5
19
user_inverter_count
X
3
582
Y
3
102
Width
3
100
Height
3
21
Value
1
1.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
6
Numeric

1
16
Name
5
23
user_modules_per_string
X
3
582
Y
3
54
Width
3
100
Height
3
21
Value
1
10.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Numeric

1
16
Name
5
24
user_strings_in_parallel
X
3
582
Y
3
78
Width
3
100
Height
3
21
Value
1
4.000000
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
16
Name
5
15
vdcmax_inverter
X
3
417
Y
3
249
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
17
Numeric

1
16
Name
5
10
vmp_string
X
3
150
Y
3
321
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
13
Numeric

1
16
Name
5
10
voc_string
X
3
150
Y
3
297
Width
3
82
Height
3
21
Value
1
9999.000000
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12

65
array_area
3
1
Total module area
m2
PV System Design
0
8
1
1
1
1
0.000000
Default
batt_max_power
3
1
Battery maximum power
kWdc
Battery
0
8
1
1
1
1
0.000000
Numeric
dcac_ratio
3
1
DC to AC ratio
 
PV System Design
0
2
1
1
1
1
1.100000
Numeric
desired_size
3
1
Desired array size
kWdc
PV System Design
0
2
1
1
1
1
10.000000
Numeric
inverter_count
3
1
Number of inverters
 
PV System Design
15
=\pv_size_array
8
1
1
1
1
1.000000
Numeric
layout_warning
3
4
 
 
PV System Design
0
5
1
4
0
MultilineText
modules_per_string
3
1
Modules per string
 
PV System Design
15
=\pv_size_array
8
1
1
1
1
10.000000
Numeric
mppt_hi_inverter
3
1
Maximum MPPT voltage
Vdc
PV System Design
0
8
1
1
1
1
0.000000
Numeric
mppt_low_inverter
3
1
Minimum MPPT voltage
Vdc
PV System Design
0
8
1
1
1
1
0.000000
Numeric
num_enabled
3
1
 
 
PV System Design
0
8
1
1
1
1
0.000000
Default
num_strings_total
3
1
Strings in array
 
PV System Design
32
=${pv.array.strings_in_parallel}
8
1
1
1
1
0.000000
Numeric
offset
3
1
Row offset
m
PV System Design
0
0
1
1
1
1
0.000000
Default
size_auto_or_manual
3
1
Mode
 
PV System Design
56
Specify desired array size|Specify modules and inverters
1
1
1
1
1
0.000000
RadioChoice
strings_in_parallel
3
1
Strings in parallel
 
PV System Design
15
=\pv_size_array
8
1
1
1
1
4.000000
Numeric
subarray1_azimuth
3
1
Azimuth 1
deg
PV System Design
0
3
1
1
1
1
180.000000
Numeric
subarray1_backtrack
3
1
Enable backtracking 1
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray1_gcr
3
1
Ground coverage ratio 1
 
PV System Design
0
3
1
1
1
1
0.300000
Default
subarray1_monthly_tilt
3
2
Subarray 1 monthly tilt input for seasonal tilt arrays
degrees
PV System Design
0
1
1
2
1
12
0.000000 40.000000 40.000000 20.000000 20.000000 20.000000 20.000000 20.000000 20.000000 40.000000 40.000000 40.000000 

MonthlyFactor
subarray1_nstrings
3
1
Number of parallel strings 1
 
PV System Design
215
=${pv.array.strings_in_parallel}
    - ?${pv.subarray2.enable}[0|${pv.subarray2.num_strings}]
    - ?${pv.subarray3.enable}[0|${pv.subarray3.num_strings}]
    - ?${pv.subarray4.enable}[0|${pv.subarray4.num_strings}]
9
1
1
1
1
0.000000
Numeric
subarray1_rotlim
3
1
Tracker rotation limit 1
degrees
PV System Design
0
3
1
1
1
1
45.000000
Numeric
subarray1_tilt
3
1
Tilt 1
deg
PV System Design
0
3
1
1
1
1
0.000000
Numeric
subarray1_tilt_eq_lat
3
1
 
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray1_track_mode
3
1
Tracking mode 1
 
PV System Design
46
Fixed|1 Axis|2 Axis|Azimuth Axis|Seasonal Tilt
3
1
1
1
1
0.000000
RadioChoice
subarray2_azimuth
3
1
Azimuth 2
deg
PV System Design
0
3
1
1
1
1
180.000000
Numeric
subarray2_backtrack
3
1
Enable backtracking 2
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray2_enable
3
1
Enable subarray 2
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray2_gcr
3
1
Ground coverage ratio 2
 
PV System Design
0
3
1
1
1
1
0.300000
Default
subarray2_monthly_tilt
3
2
Subarray 2 monthly tilt input for seasonal tilt arrays
degrees
PV System Design
0
1
1
2
1
12
0.000000 40.000000 40.000000 20.000000 20.000000 20.000000 20.000000 20.000000 20.000000 40.000000 40.000000 40.000000 

Default
subarray2_nstrings
3
1
Number of parallel strings 2
 
PV System Design
0
3
1
1
1
1
0.000000
Numeric
subarray2_rotlim
3
1
Tracker rotation limit 2
degrees
PV System Design
0
3
1
1
1
1
45.000000
Numeric
subarray2_tilt
3
1
Tilt 2
deg
PV System Design
0
3
1
1
1
1
20.000000
Numeric
subarray2_tilt_eq_lat
3
1
 
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray2_track_mode
3
1
Tracking mode 2
 
PV System Design
46
Fixed|1 Axis|2 Axis|Azimuth Axis|Seasonal Tilt
3
1
1
1
1
0.000000
RadioChoice
subarray3_azimuth
3
1
Azimuth 3
deg
PV System Design
0
3
1
1
1
1
180.000000
Numeric
subarray3_backtrack
3
1
Enable backtracking 3
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray3_enable
3
1
Enable subarray 3
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray3_gcr
3
1
Ground coverage ratio 3
 
PV System Design
0
3
1
1
1
1
0.300000
Default
subarray3_monthly_tilt
3
2
Subarray 3 monthly tilt input for seasonal tilt arrays
degrees
PV System Design
0
1
1
2
1
12
0.000000 40.000000 40.000000 20.000000 20.000000 20.000000 20.000000 20.000000 20.000000 40.000000 40.000000 40.000000 

Default
subarray3_nstrings
3
1
Number of parallel strings 3
 
PV System Design
0
3
1
1
1
1
0.000000
Numeric
subarray3_rotlim
3
1
Tracker rotation limit 3
degrees
PV System Design
0
3
1
1
1
1
45.000000
Numeric
subarray3_tilt
3
1
Tilt 3
deg
PV System Design
0
3
1
1
1
1
20.000000
Numeric
subarray3_tilt_eq_lat
3
1
 
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray3_track_mode
3
1
Tracking mode 3
 
PV System Design
46
Fixed|1 Axis|2 Axis|Azimuth Axis|Seasonal Tilt
3
1
1
1
1
0.000000
RadioChoice
subarray4_azimuth
3
1
Azimuth 4
deg
PV System Design
0
3
1
1
1
1
180.000000
Numeric
subarray4_backtrack
3
1
Enable backtracking 4
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray4_enable
3
1
Enable subarray 4
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray4_gcr
3
1
Ground coverage ratio 4
 
PV System Design
0
3
1
1
1
1
0.300000
Default
subarray4_monthly_tilt
3
2
Subarray 4 monthly tilt input for seasonal tilt arrays
degrees
PV System Design
0
1
1
2
1
12
0.000000 40.000000 40.000000 20.000000 20.000000 20.000000 20.000000 20.000000 20.000000 40.000000 40.000000 40.000000 

Default
subarray4_nstrings
3
1
Number of parallel strings 4
 
PV System Design
0
3
1
1
1
1
0.000000
Numeric
subarray4_rotlim
3
1
Tracker rotation limit 4
degrees
PV System Design
0
3
1
1
1
1
45.000000
Numeric
subarray4_tilt
3
1
Tilt 4
deg
PV System Design
0
3
1
1
1
1
20.000000
Numeric
subarray4_tilt_eq_lat
3
1
 
 
PV System Design
0
3
1
1
1
1
0.000000
CheckBox
subarray4_track_mode
3
1
Tracking mode 4
 
PV System Design
46
Fixed|1 Axis|2 Axis|Azimuth Axis|Seasonal Tilt
3
1
1
1
1
0.000000
RadioChoice
system_capacity
3
1
Nameplate capacity
kWdc
PV System Design
0
8
1
1
1
1
0.000000
Numeric
total_area
3
1
Total module area
m²
PV System Design
0
8
1
1
1
1
0.000000
Numeric
total_dc_inverter_capacity
3
1
Total capacity
kWdc
PV System Design
0
8
1
1
1
1
0.000000
Numeric
total_inverter_capacity
3
1
Total capacity
kWac
PV System Design
0
8
1
1
1
1
0.000000
Numeric
total_land_area
3
1
Total land area
acres
PV System Design
0
8
1
1
1
1
0.000000
Numeric
total_modules
3
1
Number of modules
 
PV System Design
0
8
1
1
1
1
0.000000
Numeric
user_inverter_count
3
1
Number of inverters
 
PV System Design
0
2
1
1
1
1
1.000000
Numeric
user_modules_per_string
3
1
Modules per string
 
PV System Design
0
2
1
1
1
1
10.000000
Numeric
user_strings_in_parallel
3
1
Strings in parallel
 
PV System Design
0
2
1
1
1
1
4.000000
Numeric
vdcmax_inverter
3
1
Maximum DC voltage
Vdc
PV System Design
0
8
1
1
1
1
0.000000
Numeric
vmp_string
3
1
String Vmp
V
PV System Design
0
8
1
1
1
1
0.000000
Numeric
voc_string
3
1
String Voc
V
PV System Design
0
8
1
1
1
1
0.000000
Numeric

8899
equations{ '$MIMO$ pv_size_array' } = define()
{
	if (${size_auto_or_manual}==1)
	{
		${modules_per_string} = ${user_modules_per_string};
		${strings_in_parallel} = ${user_strings_in_parallel};
		${inverter_count} = ${user_inverter_count};
		//positive number of inverters warning
	}
	if (${size_auto_or_manual}==0)
	{
		/* Sizing rules
		1. Voc < Vdcmax
		2. Vmp > Vmin
		3. Vmp < Vmax
		4. num series * num_parallel is about desired array size (num_parallel = desired / (num series * mod_power)
		5. num inverters is about desired array size (num_inv = num_series * num_parallel * mod_power) / inv_power
		*/
			
		// module parameters
		mod_vmp= ?${module_model} [	${spe_vmp},${cec_v_mp_ref},${6par_vmp},${snl_ref_vmp},${sd11par_Vmp0}];
		mod_voc= ?${module_model} [	${spe_voc},${cec_v_oc_ref},${6par_voc},${snl_ref_voc},${sd11par_Voc0}];
		mod_power= ?${module_model} [${spe_power}, ${cec_p_mp_ref}, ${6par_pmp}, ${snl_ref_pmp},${sd11par_Pmp0}];
		//default logstatus mimo_pv_size_array: Invalid module selection
		//if mod_power<=0 logstatus mimo_pv_size_array: The module power is less than zero.Please check the module selected
		//if mod_vmp<=0 logstatus mimo_pv_size_array: The module Vmp = %lg Wdc. The sizing wizard only works with modules with positive Vmp

		// inverter parameters
		inv_vmin= ?${inverter_model} [${inv_snl_mppt_low}, ${inv_ds_mppt_low}, ${inv_pd_mppt_low},${inv_cec_cg_mppt_low}];
		inv_vdcmax= ?${inverter_model} [${inv_snl_vdcmax}, ${inv_ds_vdcmax}, ${inv_pd_vdcmax},${inv_cec_cg_vdcmax}];
		inv_vmax= ?${inverter_model} [${inv_snl_mppt_hi}, ${inv_ds_mppt_hi}, ${inv_pd_mppt_hi},${inv_cec_cg_mppt_hi}];
		inv_power= ?${inverter_model} [${inv_snl_paco}, ${inv_ds_paco}, ${inv_pd_paco},${inv_cec_cg_paco}];
		//default logstatus mimo_pv_size_array: Invalid inverter selection
		
		// DC-connected battery parameters (assumed to use common inverter)
		batt_max_power_dc = 0;
		
		f = financing();
		if (f != "LCOE Calculator" && f != "None")
		{
			if (${en_batt}){
				if (${batt_ac_or_dc} == 0)
					batt_max_power_dc = ${batt_max_power};
			}
		}
		
		// calculations
		if(mod_vmp>0)
		{num_series= 0.5 * (inv_vmin + inv_vmax)/mod_vmp;}
		if(inv_vdcmax > 0){
			while ((num_series > 0) && ((num_series*mod_voc) > inv_vdcmax)){
				num_series= num_series -1;
			}
		}
		if (num_series < 1)
		{ num_series= 1;}
		num_series= to_int(num_series);
		num_parallel= ${desired_size} * 1000 /(num_series * mod_power);
		if (num_parallel < 1)
		{ num_parallel= 1;}
		num_parallel= to_int(num_parallel);
		//if (desired_size * 1000 < inv_power) logstatus mimo_pv_size_array: The desired array power is less than a single inverter capacity
		if (${dcac_ratio} > 0)
		{ 	inverters = ((num_series * num_parallel * mod_power) /* + batt_max_power_dc */) / (${dcac_ratio} * inv_power);
			//round inverters for best DC-AC ratio
			if((inverters - floor(inverters)) < 0.5)
			{	num_inverters = floor(inverters); }
			else
			{	num_inverters = ceil(inverters); }
		}
				
		else
		{ num_inverters = ceil(((num_series * num_parallel * mod_power) /* + batt_max_power_dc */) / inv_power);}
		if (num_inverters < 1)
		{ num_inverters = 1;}
		
		${modules_per_string} = num_series;
		${strings_in_parallel} = num_parallel;
		${inverter_count} = num_inverters;
	}
};

equations{ 'total_modules' } = define() {	
	return ${modules_per_string} * ${strings_in_parallel}; };

equations{ 'system_capacity' } = define() {
	return ?${module_model}
[
	${spe_power},
	${cec_p_mp_ref},
	${6par_pmp},
	${snl_ref_pmp},
	${sd11par_Pmp0}
] 
	* ${total_modules} / 1000; };
	
equations{ 'total_area' } = define() {
	return ?${module_model}
[
	${spe_area},
	${cec_area},
	${6par_area},
	${snl_area},
	${sd11par_area}
] 
	* ${total_modules}; };

equations{ 'voc_string' } = define() {
	return ?${module_model}
[
	${spe_voc},
	${cec_v_oc_ref},
	${6par_voc},
	${snl_voco},
	${sd11par_Voc0}
]
	* ${modules_per_string}; };
	
equations{ 'vmp_string' } = define() {
	return ?${module_model}
[
	${spe_vmp},
	${cec_v_mp_ref},
	${6par_vmp},
	${snl_ref_vmp},
	${sd11par_Vmp0}
]
	* ${modules_per_string}; };

equations{ 'total_inverter_capacity' } = define() {
	return ?${inverter_model} 
[ 
	${inv_snl_paco},
	${inv_ds_paco}, 
	${inv_pd_paco}, 
	${inv_cec_cg_paco}
] 
	* ${inverter_count} /1000; };

equations{ 'total_dc_inverter_capacity' } = define() {
	return ?${inverter_model} 
[ 
	${inv_snl_pdco},
	${inv_ds_pdco}, 
	${inv_pd_pdco}, 
	${inv_cec_cg_pdco}
] 
	* ${inverter_count} /1000; };
	
equations{ 'vdcmax_inverter' } = define() {
	return ?${inverter_model}
[
	${inv_snl_vdcmax},
	${inv_ds_vdcmax},
	${inv_pd_vdcmax},
	${inv_cec_cg_vdcmax}
]; };

equations{ 'mppt_low_inverter' } = define() {
	return ?${inverter_model} 
[ 	
	${inv_snl_mppt_low}, 
	${inv_ds_mppt_low}, 
	${inv_pd_mppt_low},
	${inv_cec_cg_mppt_low}	
]; };

equations{ 'mppt_hi_inverter' } = define() {
	return ?${inverter_model} 
[ 
	${inv_snl_mppt_hi}, 
	${inv_ds_mppt_hi},
	${inv_pd_mppt_hi},
	${inv_cec_cg_mppt_hi}
]; };

equations{ 'num_enabled' } = define() {
	return 1+${subarray2_enable}+${subarray3_enable}+${subarray4_enable}; };

equations{ 'num_strings_total' } = define() {
	return ${strings_in_parallel}; };

equations{ 'subarray1_nstrings' } = define() {
	return ${strings_in_parallel}
    - ?${subarray2_enable}[0,${subarray2_nstrings}]
    - ?${subarray3_enable}[0,${subarray3_nstrings}]
    - ?${subarray4_enable}[0,${subarray4_nstrings}]; };

equations{ 'total_land_area' } = define() {
	area = ?${module_model}
	[
		${spe_area},
		${cec_area},
		${6par_area},
		${snl_area},
		${sd11par_area}
	] ;
	land = ${modules_per_string} * area *
		(${subarray1_nstrings}/${subarray1_gcr} +
		 ${subarray2_enable}*${subarray2_nstrings}/${subarray2_gcr} + 
		 ${subarray3_enable}*${subarray3_nstrings}/${subarray3_gcr} +
		 ${subarray4_enable}*${subarray4_nstrings}/${subarray4_gcr});
	return land	* 0.0002471; }; //convert to acres

equations{ 'array_area' } = define() {
	return ${total_area}; };
	
equations{ 'layout_warning'} = define(){

	// DC-connected battery parameters (assumed to use common inverter)
	dc_connected_battery = false;
	f = financing();
	if (f != "LCOE Calculator" && f != "None")
	{
		if (${en_batt}){
			if (${batt_ac_or_dc} == 0)
			{
				value = (${system_capacity} + ${batt_max_power})/${total_inverter_capacity};
				value_no_batt = (${system_capacity})/${total_inverter_capacity};
				
				message = ('DC/AC ratio for PV only is ' + sprintf('%.2f', value_no_batt) + '.\nActual DC/AC ratio with DC-connected battery (common inverter) is ' +  sprintf('%.2f', value) + '.\n');
				dc_connected_battery = true;
			}
		}

	}
	if (!dc_connected_battery)
	{
		value = ${system_capacity}/${total_inverter_capacity};
		message = ('Actual DC/AC ratio is ' +  sprintf('%.2f', value) + '. ');
	}
	
	//dc-ac ratio information for auto-sized systems
	if(${size_auto_or_manual} == 0 && abs(value - ${dcac_ratio}) > 0.05)
	{
		message += 'To get closer to the desired DC/AC Ratio, you may need to select a different module and/or inverter. ';
		if (dc_connected_battery)
			message += 'Or modify battery size. ';
	}	
	//string voltage information for both manually and automatically sized systems		
	mod_vmp= ?${module_model} [	${spe_vmp},${cec_v_mp_ref},${6par_vmp},${snl_ref_vmp},${sd11par_Vmp0}];
	mod_voc= ?${module_model} [	${spe_voc},${cec_v_oc_ref},${6par_voc},${snl_ref_voc},${sd11par_Voc0}];

	min_modules = ceil(${mppt_low_inverter} / mod_vmp);
	max_modules = floor(${mppt_hi_inverter} / mod_voc);
	if ( ${mppt_low_inverter} == 0 || ${mppt_hi_inverter} == 0 )
	{
		message +='\nThis inverter does not have data for MPPT voltage limits, so SAM cannot calculate MPPT clipping.';
	}
	elseif (max_modules < min_modules)
	{
		message += '\nFor this combination of module and inverter, it is not possible to size the string to keep string Voc and Vmp within the MPPT voltage limits. ';
		message += 'To avoid inverter MPPT clipping, try a different module or inverter. ';
	}
	else 
	{
		if (${voc_string} < ${mppt_low_inverter} || ${vmp_string} < ${mppt_low_inverter})
			message += '\nThe string voltage is below the inverter minimum MPPT voltage at reference conditions. Consider using more modules per string.';
		else if (${voc_string} > ${vdcmax_inverter} || ${vmp_string} > ${vdcmax_inverter})
			message += '\nThe string voltage exceeds the inverter maximum rated voltage at reference conditions. Consider using fewer modules per string.';
		else if (${voc_string} > ${mppt_hi_inverter} || ${vmp_string} > ${mppt_hi_inverter})
			message += '\nThe string voltage exceeds the inverter maximum MPPT voltage at reference conditions. Consider using fewer modules per string.';
	}

	return message; 
};

equations{ 'batt_max_power' } = define() 
{
	max_power = 0;
	f = financing();
	if (f != "LCOE Calculator" && f != "None")
	{
		if (${en_batt})
			max_power = ${batt_power_discharge_max};
	}
	return max_power;
};

4366
on_load{'PV System Design'} = define()
{
	on_change{'size_auto_or_manual'}();	
	on_change{'subarray1_tilt_eq_lat'}();
	on_change{'subarray1_track_mode'}();
	
	// enable/disable subarrays
	on_change{'subarray2_enable'}();
	on_change{'subarray3_enable'}();
	on_change{'subarray4_enable'}();
	
	inverter_warning_check();
};

on_change{'size_auto_or_manual'} = define()
{
	isauto = (value('size_auto_or_manual') == 0);
	
	enable( 'desired_size', isauto);
	enable( 'dcac_ratio', isauto);

	enable( 'user_modules_per_string', !isauto );
	enable( 'user_strings_in_parallel', !isauto );
	enable( 'user_inverter_count', !isauto );
	
	inverter_warning_check();
};

function inverter_warning_check()
{
	message = '';
	
	// if inverter has no operating voltage limit, display warning
	if (${vdcmax_inverter} == 0 && ${size_auto_or_manual} == 0)
		message = 'Inverter voltage limits are not available for this inverter. Modules per string set to 1.';
	
	property( 'pv_system_inverter_voltage_warning','Caption',message );
}


function sysdesign_enable_subarray_items( isub, en )
{
	prefix = "subarray" + to_string(isub) + "_";
	vars = [
		"azimuth",
		"nstrings",
		"rotlim",
		"tilt",
		"tilt_eq_lat",
		"track_mode",
		"gcr" ];
	
	for (i=0;i<#vars;i++)
		enable( prefix + vars[i], en );
}

function sysdesign_enable_tracking_type( isub )
{
	prefix = "subarray" + to_string(isub) + "_";
	sub_enabled = 1;
	if (isub > 1)
		sub_enabled = value(prefix + "enable");
	tracking = value(prefix + "track_mode");
	
	//tilt inputs: show/hide single value or seasonal
	seasonal = (tracking == 4);
	show(prefix + "monthly_tilt", seasonal);
	show(prefix + "tilt_eq_lat", !seasonal);
	show(prefix + "tilt", !seasonal);
	
	//tilt=lat checkbox: subarray must be enabled and tracking mode must be fixed, 1-axis, or A-axis	
	enable(prefix + "tilt_eq_lat", sub_enabled && (tracking == 0 || tracking == 1 || tracking == 3));
	
	//tilt: subarray must be enabled, tracking mode must be fixed, 1-axis, or A-axis, and tilt=lat must not be checked
	tel = value(prefix+"tilt_eq_lat");
	enable(prefix + "tilt", sub_enabled && (tel==0) && (tracking == 0 || tracking == 1 || tracking == 3));

	//azimuth: subarray must be enabled, trackind mode must be fixed, 1-axis, or seasonal
	enable( prefix+"azimuth", (tracking == 1 || tracking == 0 || tracking == 4) && sub_enabled );
	
	//gcr is always enabled if subarray is, in function sysdesign_enable_subarray_items()
	//tracker rotation limit and backtracking: subarray must be enabled, tracking mode must be 1-axis
	enable( prefix+"rotlim", (tracking == 1) && sub_enabled );
	enable( prefix+"backtrack", (tracking==1) && sub_enabled);

}

on_change{'subarray2_enable'} = define() { sysdesign_enable_subarray_items( 2, value('subarray2_enable') );  sysdesign_enable_tracking_type( 2 ); };
on_change{'subarray3_enable'} = define() { sysdesign_enable_subarray_items( 3, value('subarray3_enable') );  sysdesign_enable_tracking_type( 3 ); };
on_change{'subarray4_enable'} = define() { sysdesign_enable_subarray_items( 4, value('subarray4_enable') );  sysdesign_enable_tracking_type( 4 ); };


//on_change{'subarray1_tilt_eq_lat'} = define() { enable( 'subarray1_tilt', value('subarray1_tilt_eq_lat') == 0 ); };
//on_change{'subarray2_tilt_eq_lat'} = define() { enable( 'subarray2_tilt', value('subarray2_tilt_eq_lat') == 0  && value('subarray2_enable') ); };
//on_change{'subarray3_tilt_eq_lat'} = define() { enable( 'subarray3_tilt', value('subarray3_tilt_eq_lat') == 0  && value('subarray3_enable') ); };
//on_change{'subarray4_tilt_eq_lat'} = define() { enable( 'subarray4_tilt', value('subarray4_tilt_eq_lat') == 0  && value('subarray4_enable') ); };

on_change{'subarray1_tilt_eq_lat'} = define() { sysdesign_enable_tracking_type( 1 ); };
on_change{'subarray2_tilt_eq_lat'} = define() { sysdesign_enable_tracking_type( 2 ); };
on_change{'subarray3_tilt_eq_lat'} = define() { sysdesign_enable_tracking_type( 3 ); };
on_change{'subarray4_tilt_eq_lat'} = define() { sysdesign_enable_tracking_type( 4 ); };

on_change{'subarray1_track_mode'} = define() {  sysdesign_enable_tracking_type( 1 );  };
on_change{'subarray2_track_mode'} = define() {  sysdesign_enable_tracking_type( 2 );  };
on_change{'subarray3_track_mode'} = define() {  sysdesign_enable_tracking_type( 3 );  };
on_change{'subarray4_track_mode'} = define() {  sysdesign_enable_tracking_type( 4 );  };